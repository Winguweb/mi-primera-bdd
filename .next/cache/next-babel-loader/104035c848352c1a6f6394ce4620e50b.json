{"ast":null,"code":"/* /lib/auth.js */\nimport jwtDecode from \"jwt-decode\";\nimport Cookies from \"js-cookie\";\nimport Strapi from \"strapi-sdk-javascript/build/main\";\nimport Router from \"next/router\";\nvar apiUrl = process.env.API_URL || \"http://localhost:1337\";\nvar strapi = new Strapi(apiUrl);\nexport var strapiRegister = function strapiRegister(username, email, password) {\n  if (!true) {\n    return undefined;\n  }\n\n  strapi.register(username, email, password).then(function (res) {\n    setToken(res);\n  });\n  return Promise.resolve();\n}; //use strapi to get a JWT and token object, save\n//to approriate cookei for future requests\n\nexport var strapiLogin = function strapiLogin(email, password) {\n  if (!true) {\n    return;\n  } // Get a token\n\n\n  strapi.login(email, password).then(function (res) {\n    setToken(res);\n  });\n  return Promise.resolve();\n};\nexport var setToken = function setToken(token) {\n  if (!true) {\n    return;\n  }\n\n  Cookies.set(\"username\", token.user.username);\n  Cookies.set(\"jwt\", token.jwt);\n  Cookies.set(\"id\", token.user.id);\n\n  if (Cookies.get(\"username\")) {\n    Router.push(\"/\");\n  }\n};\nexport var unsetToken = function unsetToken() {\n  if (!true) {\n    return;\n  }\n\n  Cookies.remove(\"jwt\");\n  Cookies.remove(\"username\");\n  Cookies.remove(\"cart\"); // to support logging out from all windows\n\n  window.localStorage.setItem(\"logout\", Date.now());\n  Router.push(\"/login\");\n};\nexport var getUserFromServerCookie = function getUserFromServerCookie(req) {\n  if (!req.headers.cookie || \"\") {\n    return undefined;\n  }\n\n  var username = req.headers.cookie.split(\";\").find(function (user) {\n    return user.trim().startsWith(\"username=\");\n  });\n\n  if (username) {\n    username = username.split(\"=\")[1];\n  }\n\n  var jwtCookie = req.headers.cookie.split(\";\").find(function (c) {\n    return c.trim().startsWith(\"jwt=\");\n  });\n\n  if (!jwtCookie) {\n    return undefined;\n  }\n\n  var jwt = jwtCookie.split(\"=\")[1];\n  return jwtDecode(jwt), username;\n};\nexport var getUserFromLocalCookie = function getUserFromLocalCookie() {\n  return Cookies.get(\"username\");\n}; //these will be used if you expand to a provider such as Auth0\n\nvar getQueryParams = function getQueryParams() {\n  var params = {};\n  window.location.href.replace(/([^(?|#)=&]+)(=([^&]*))?/g, function ($0, $1, $2, $3) {\n    params[$1] = $3;\n  });\n  return params;\n};\n\nexport var extractInfoFromHash = function extractInfoFromHash() {\n  if (!true) {\n    return undefined;\n  }\n\n  var _getQueryParams = getQueryParams(),\n      id_token = _getQueryParams.id_token,\n      state = _getQueryParams.state;\n\n  return {\n    token: id_token,\n    secret: state\n  };\n};","map":null,"metadata":{},"sourceType":"module"}